<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nightly Stats Tool</title>
    <link rel="icon" type="image/x-icon" href="Resources/NightlyStats.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <img src="Resources/NightlyStats.ico" alt="Nightly Stats Icon" class="header-icon" onerror="this.style.display='none'">
            <h1>Nightly Stats Tool <span class="version">v1.0.0</span></h1>
            <div id="headerMessages" class="header-messages"></div>
            <button id="settingsBtn" class="settings-btn" title="Settings">
                <span class="settings-icon">⚙️</span>
            </button>
        </header>

        <!-- Failed Tests Section -->
        <section class="section failed-tests-section">
            <div class="section-header">
                <h2>Failed Tests</h2>
                <div class="tests-displayed-container">
                    <label>Tests Displayed: <span id="totalTests">0</span></label>
                </div>
            </div>
            <div class="filters">
                <div class="filter-group">
                    <label>Run Date:</label>
                    <input type="date" id="runDate" />
                </div>
                <div class="filter-group filter-group-env">
                    <label>Env:</label>
                    <select id="envFilter">
                        <option value="--">--</option>
                        <option value="TEST">TEST</option>
                        <option value="PROD">PROD</option>
                        <option value="A2">A2</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Project:</label>
                    <select id="projectFilter">
                        <option value="--">--</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Type:</label>
                    <select id="typeFilter">
                        <option value="--">--</option>
                        <option value="UI">UI</option>
                        <option value="API">API</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Browser:</label>
                    <select id="browserFilter">
                        <option value="--">--</option>
                        <option value="Firefox">Firefox</option>
                        <option value="Chrome">Chrome</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Owner:</label>
                    <select id="ownerFilter">
                        <option value="--">--</option>
                        <option value="Christa">Christa</option>
                        <option value="Becky">Becky</option>
                        <option value="Abbee">Abbee</option>
                        <option value="N/A">N/A</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Discount State:</label>
                    <select id="discountedFilter">
                        <option value="all">All</option>
                        <option value="discounted">Discounted</option>
                        <option value="not-discounted">Not Discounted</option>
                    </select>
                </div>
                <div class="filter-group filter-buttons">
                    <button id="resetFilters" class="btn btn-secondary">Reset Filters</button>
                </div>
                <div class="filter-group filter-refresh-btn">
                    <button id="refreshTable" class="btn btn-primary">Refresh Table</button>
                </div>
            </div>
            <div class="table-container">
                <table id="failedTestsTable" class="data-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" /></th>
                            <th>Id</th>
                            <th>Build No</th>
                            <th>Type</th>
                            <th>Env</th>
                            <th>Project</th>
                            <th>Test Name</th>
                            <th>Rerun</th>
                            <th>Error</th>
                            <th>Disc Code</th>
                            <th>Disc Reason</th>
                            <th>Browser</th>
                            <th>Owner</th>
                            <th>Create Date UTC</th>
                        </tr>
                    </thead>
                    <tbody id="failedTestsBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
            <div class="table-divider"></div>
            <div class="table-footer-container">
                <div class="post-stats-button-container">
                    <button id="postNightlyStats" class="btn btn-success">Post Nightly Stats</button>
                </div>
                <div class="footer-action-buttons">
                    <button id="openScreenshot" class="btn btn-primary btn-small">Open Screenshot</button>
                    <button id="openTestDetails" class="btn btn-primary btn-small">Open Test Details</button>
                    <button id="launchJob" class="btn btn-primary btn-small btn-jenkins">Open Jenkins Run</button>
                    <button id="rerunTest" class="btn btn-success-dark btn-small">Rerun Selected Test(s)</button>
                </div>
                <div class="footer-counts-section">
                    <div class="count-item">
                        <label class="count-label-red">Total N/A Failed: <span id="totalNAFailed">0</span></label>
                    </div>
                    <div class="count-item">
                        <label class="count-label-red">Total Failed: <span id="totalFailed">0</span></label>
                    </div>
                </div>
            </div>
        </section>

        <!-- Manual Discounting, Run Job, and Actions Layout -->
        <div class="discount-run-job-layout">
            <!-- Discounting Section -->
            <section class="section discounting-section">
                <div class="discounting-header">
                    <h2>Manual Discounts</h2>
                    <button id="discountSelected" class="btn btn-primary">Discount</button>
                </div>
                <p class="instruction-text">Select test(s) from top table to discount manually</p>
                <div class="discount-controls">
                    <div class="form-group">
                        <label>Discount Code:</label>
                        <select id="discountCode">
                            <option value="">Select...</option>
                            <option value="External Team">External Team</option>
                            <option value="CRM DevOps">CRM DevOps</option>
                            <option value="Bug Found By Automation">Bug Found By Automation</option>
                            <option value="Code Change">Code Change</option>
                            <option value="Automation Testing">Automation Testing</option>
                            <option value="Accident">Accident</option>
                            <option value="Jenkins">Jenkins</option>
                            <option value="Deploy">Deploy</option>
                            <option value="Holiday">Holiday</option>
                            <option value="Clear Discount">Clear Discount</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Discount Reason - include #slack channel if External Team</label>
                        <textarea id="discountReason" placeholder="Enter reason..." rows="3"></textarea>
                    </div>
                </div>
            </section>

            <!-- Run Job Section -->
            <section class="section run-job-section">
                <div class="run-job-header">
                    <h2>Run Regression</h2>
                    <button id="runTests" class="btn btn-primary">Run Tests</button>
                </div>
                <div class="run-job-controls">
                    <div class="form-group">
                        <label>Project to Run:</label>
                        <select id="projectToRun">
                            <option value="--">--</option>
                        </select>
                    </div>
                    <div class="form-group-row">
                        <div class="form-group">
                            <label>Branch:</label>
                            <select id="branch">
                                <option value="dev">dev</option>
                                <option value="main">main</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Env:</label>
                            <select id="envToRun">
                                <option value="TEST">TEST</option>
                                <option value="PROD">PROD</option>
                                <option value="A2">A2</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Jira ID:</label>
                            <input type="text" id="jiraId" value="CRM-" />
                        </div>
                        <div class="form-group">
                            <label>Browser:</label>
                            <select id="browserToRun">
                                <option value="">--</option>
                                <option value="Firefox">Firefox</option>
                                <option value="Chrome" selected>Chrome</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tests to Run (space separated):</label>
                        <input type="text" id="testsToRun" />
                    </div>
                </div>
            </section>

            <!-- Checklist Section -->
            <section class="section checklist-section">
                <h2>World Domination Reminders/Checklist</h2>
                <div class="checklist-controls">
                    <label>
                        <input type="checkbox" id="showChecklist" />
                        Show Checklist
                    </label>
                </div>
                <div id="checklist" class="checklist" style="display: none;">
                    <label><input type="checkbox" /> Rerun tests that can pass</label>
                    <label><input type="checkbox" /> Check count stats; Update Project Manager</label>
                    <label><input type="checkbox" /> Check for patterns and obvious failures</label>
                    <label><input type="checkbox" /> Discount failures</label>
                    <label><input type="checkbox" /> Post stats</label>
                    <label><input type="checkbox" /> Rule the world</label>
                </div>
                <div id="reminders" class="reminders">
                    <div class="reminder-item">
                        <div class="reminder-text reminder-text-with-buttons">
                            <span>If IVR failing tests contain 'Locked' run qe-crm-api-ivr-dotnet-Maintenance job for correct env before rerunning</span>
                            <div class="reminder-buttons">
                                <button id="ivrTest" class="btn btn-secondary btn-reminder">IVR TEST</button>
                                <button id="ivrProd" class="btn btn-secondary btn-reminder">IVR PROD</button>
                            </div>
                        </div>
                    </div>
                    <div class="reminder-item">
                        <div class="reminder-text reminder-text-with-buttons">
                            <span>If phone tests failing with 'Cisco agent for [machineName] is not accepting login for agent', try resetting Jabber client, click Phone link for steps.</span>
                            <div class="reminder-buttons">
                                <button id="phoneDoc" class="btn btn-secondary btn-reminder">Phone doc</button>
                                <button id="cyberArk" class="btn btn-secondary btn-reminder">CyberArk</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Quick Actions Section -->
        <section class="section quick-actions-section">
            <button id="projectManagerLink" class="btn btn-primary">Project Manager</button>
            <button class="btn btn-primary" disabled>Button 2</button>
            <button class="btn btn-primary" disabled>Button 3</button>
            <button class="btn btn-primary" disabled>Button 4</button>
        </section>

        <!-- Discounts and Stats Layout -->
        <div class="discounts-stats-layout">
            <!-- Copying Discounts Section -->
            <section class="section copying-discounts-section">
                <div class="copying-header">
                    <h2>Copy Previous Discounts</h2>
                    <button id="copyDiscounts" class="btn btn-primary">Copy Discounts</button>
                </div>
                <div class="copy-discounts-controls">
                    <button id="getYesterdays" class="btn btn-primary">Get Previous Day's</button>
                    <label class="days-back-label">Days Back:</label>
                    <input type="number" id="daysBack" value="4" min="1" class="days-back-input" />
                    <button id="getRecentDiscount" class="btn btn-primary">Get Days Back</button>
                </div>
                <div class="table-container">
                    <table id="yesterdaysDiscountsTable" class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllDiscounts" /></th>
                                <th>Id</th>
                                <th>Type</th>
                                <th>Env</th>
                                <th>Project</th>
                                <th>Test Name</th>
                                <th>Error</th>
                                <th>Disc Code</th>
                                <th>Disc Reason</th>
                                <th>Build No</th>
                                <th>Create Date UTC</th>
                            </tr>
                        </thead>
                        <tbody id="yesterdaysDiscountsBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Stats Sections -->
            <div class="stats-sections-wrapper">
                <section class="section stats-section-individual">
                    <div class="stats-header">
                        <h2>Nightly Stats</h2>
                        <button id="generateStats" class="btn btn-primary">Generate Nightly Stats</button>
                    </div>
                    <textarea id="nightlyStats" readonly></textarea>
                </section>

                <section class="section stats-section-individual">
                    <div class="stats-header">
                        <h2>Count Stats</h2>
                        <button id="generateCountStats" class="btn btn-primary">Generate Count Stats</button>
                    </div>
                    <textarea id="countStats" readonly></textarea>
                </section>
            </div>
        </div>


    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-modal-content">
            <span class="close" id="closeSettings">&times;</span>
            <h2>Settings</h2>
            <div class="settings-content">
                <div class="setting-item">
                    <label for="themeSelect">Theme:</label>
                    <select id="themeSelect" class="setting-select">
                        <option value="auto">Auto (System)</option>
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="ownerAtStart">Owner at Start:</label>
                    <select id="ownerAtStart" class="setting-select">
                        <option value="--">--</option>
                        <option value="Christa">Christa</option>
                        <option value="Becky">Becky</option>
                        <option value="Abbee">Abbee</option>
                        <option value="N/A">N/A</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Details Modal -->
    <div id="testDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Test Details</h2>
            <div id="testDetailsContent"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <script src="renderer.js"></script>
</body>
</html>

